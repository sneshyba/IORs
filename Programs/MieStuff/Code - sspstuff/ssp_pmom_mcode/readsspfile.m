function f = readsspfile(sspfile,refffile,iors_usedfile)%% Reads ssp file%% Author of original c-code, read_single_scat_database.c:% Dave Turner% Pacific Northwest National Laboratory% University of Wisconsin - Madison% Date:% July 2002%% Adapted to Matlab by Steven Neshyba, May 2009% Size of the iops part of datasetNfrompsd = 13;% Open the Reff file to get the number of radiireff = load(refffile);Nreff = length(reff);% And the index of refraction file to get that numberiors = load(iors_usedfile);NIORS = length(iors);% Open the file  fp = gopen(filename, "r");fid = fopen(sspfile,'r');% % First two lines are commentline = fgets(fid);line = fgets(fid);% Number of data lines (#wavelengths times #radii)line = fgets(fid); Nlines=getfirstnum(line);[Nlines NIORS*Nreff]% Number of phase function anglesline = fgets(fid); NANG=getfirstnum(line);% Another comment lineline = fgets(fid);% Phase anglesline = fgets(fid); ppa = str2num(line);% Read the last commented lineline = fgets(fid);% Preallocate the straight Pnrm and iops arraysPnrm_psd_straight = zeros(NANG,Nlines);iops_psd_straight = zeros(Nfrompsd,Nlines);Ntot = NANG+Nfrompsd;% Get all the datafor iline=1:Nlines    line = fgets(fid);    dline = str2num(line);    iops_psd_straight(:,iline) = dline(1:Nfrompsd);    Pnrm_psd_straight(:,iline) = dline(Nfrompsd+1:Ntot);end    %Pnrm_psd = reshape(Pnrm_psd_straight,NANG,NIORS,Nreff);%iops_psd = reshape(iops_psd_straight,Nfrompsd,NIORS,Nreff);Pnrm_psd = reshape(Pnrm_psd_straight,NANG,Nreff,NIORS);iops_psd = reshape(iops_psd_straight,Nfrompsd,Nreff,NIORS);f.NANG = NANG;f.NIORS = NIORS;f.Nreff=Nreff;f.ppa=ppa';f.Pnrm_psd=Pnrm_psd;f.iops_psd=iops_psd;f.reff=reff'f.iors=iors;% Close and get outfclose(fid);