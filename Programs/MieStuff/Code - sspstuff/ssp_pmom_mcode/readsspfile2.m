function f = readsspfile2(sspfile)%% Reads ssp file%% Author of original c-code, read_single_scat_database.c:% Dave Turner% Pacific Northwest National Laboratory% University of Wisconsin - Madison% Date:% July 2002%% Adapted to Matlab by Steven Neshyba, June 2009% Just echoing back the name of the output filesspfile% Size of the iops part of datasetNfrompsd = 13;% Open the file  fp = gopen(filename, "r");fid = fopen(sspfile,'r');% % First two lines are commentline = fgets(fid);line = fgets(fid);% Number of data lines (#wavelengths times #radii)line = fgets(fid); Nlines=getfirstnum(line);% Number of phase function anglesline = fgets(fid); NANG=getfirstnum(line);% Another comment lineline = fgets(fid);% Phase anglesline = fgets(fid); ppa = str2num(line);% Read the last commented lineline = fgets(fid);% Preallocate the straight Pnrm and iops arraysPnrm_psd_straight = zeros(NANG,Nlines);iops_psd_straight = zeros(Nfrompsd,Nlines);Ntot = NANG+Nfrompsd;% Get all the datafor iline=1:Nlines    line = fgets(fid);    dline = str2num(line);    iops_psd_straight(:,iline) = dline(1:Nfrompsd);    Pnrm_psd_straight(:,iline) = dline(Nfrompsd+1:Ntot);end% Figure out values of Nreff and NIORS from the datafor i=2:Nlines    if(iops_psd_straight(2,i) ~= iops_psd_straight(2,i-1))        Nreff = i-1;        break    endendNIORS = round(Nlines/Nreff);Pnrm_psd = reshape(Pnrm_psd_straight,NANG,Nreff,NIORS);iops_psd = reshape(iops_psd_straight,Nfrompsd,Nreff,NIORS);f.NANG = NANG;f.NIORS = NIORS;f.Nreff=Nreff;f.ppa=ppa';f.Pnrm_psd=Pnrm_psd;f.iops_psd=iops_psd;f.reff=iops_psd(3,:,1);% Close and get outfclose(fid);return