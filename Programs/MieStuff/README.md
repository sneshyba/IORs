# README #

Generating single-scattering parameters from indices of refraction
M Fergoda & S Neshyba

Have to add these folders to MATLAB’s path:

“Code - Maetzler-v2” 
“Code - sspstuff/ssp_pmom_mcode”

Instructions on how to make single-scattering parameter files from indices of refraction

In matlab

1. Create a working folder that contains files that specify indices of refraction. The rest of these instructions assume you’re in that folder.

2. Create/use the default for a complex index of refraction (CRI) file. The default, iors.txt, looks like this:

% iors.txt; generated by Warren's gorefice_wavenum, specifying 273 K; wavenumber (cm-1), real, imag
          4.60000E+02           1.47080           0.03365
          4.61000E+02           1.47181           0.03415
          4.62000E+02           1.47281           0.03466
          4.63000E+02           1.47380           0.03517
	…

3. Create/use the default for a phase function angle file. The default, ppa.txt, looks like the following

% ppa.txt; in degrees
   	0.0000000e+00
   	1.0000000e-01
   	2.0000000e-01
   	3.0000000e-01
   	4.0000000e-01
	…

4. Run makemieset.m. A copy of this code stays in sspstuff/ssp_pmom_mcode, BUT it needs to be modified for each run, so a modified copy should be kept in the working folder. makemieset.m calculates the phase functions and inherent optical properties for each combination of wavenumber and radius, and could take hours depending on the number of frequencies (specified in iors.txt) and radii (specified in makemieset.m itself). The outputs are files iors_used.txt, Nstuff.txt, radius.txt (immediately), and Pnrm.txt and iops.txt (when its finished). 

iors_used.txt contains a list of wave numbers interpolated to a new spacing. You should check and possibly tailor the algorithm used to generate these new wave numbers so that it produces the range and spacing desired.

5. Create/use the default for a file containing the set of desired effective radii, reff.txt. 

6. Run rungetpsd.m. As in the case of makemieset.m, a local copy in the working folder should be used, since the size distributions are hardwired in this code. rungetpsd.m code calculates average phase functions and iops, using a log-normal particle size distribution widths specified in the code, and files produced by makemieset.m. See getpsd.m, which is modified from fortran code originally written by Tom Grenfell, for details. 

Resulting files:
-A log file, 'getpsd.log’, is generated.
-an “ssp” file, which is a text file that contains phase functions and other iops, e.g., 'ssp_getpsd_T273_S487.txt’.



Instructions on how to make a moments file

Two possibilities are available:

1. (matlab) For a quick-and-dirty list of phase function moments, you can run ssp2pmom.m. But ssp2pmom.m is not stable for large moments, but it may be useful for later comparisons.

2. (python) Run ssp2pmom.ipynb. The result is a netcdf file. However, ssp2pmom.ipynb invokes an octave kernel to read the ssp files, and a fortran kernel (code written by Sally McFarlane to compute phase function moments). That all takes a bit of work to install.
